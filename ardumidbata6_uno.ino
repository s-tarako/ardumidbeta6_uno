
/***
 *      /$$$$$$                  /$$                         /$$       /$$                                                       /$$$$$$$      /$$$$$$                                                                                                                                                                                                                                                                                                                                                       
 *     /$$__  $$                | $$                        |__/      | $$                                                      | $$____/     /$$__  $$                                                                                                                                                                                                                                                                                                                                                      
 *    | $$  \ $$  /$$$$$$   /$$$$$$$ /$$   /$$ /$$$$$$/$$$$  /$$  /$$$$$$$                         /$$    /$$ /$$$$$$   /$$$$$$ | $$         |__/  \ $$                                                                                                                                                                                                                                                                                                                                      
 *    | $$  | $$| $$      | $$  | $$| $$  | $$| $$ | $$ | $$| $$| $$  | $$                          \  $$$/ | $$_____/| $$       /$$  \ $$   | $$                                                                                                                                                                                                                                                                                                                                                            
 *    | $$  | $$| $$      |  $$$$$$$|  $$$$$$/| $$ | $$ | $$| $$|  $$$$$$$                           \  $/  |  $$$$$$$| $$      |  $$$$$$//$$| $$$$$$$$                                                                                                          
 *    | $$$$$$$$ /$$__  $$ /$$__  $$| $$  | $$| $$_  $$_  $$| $$ /$$__  $$                        |  $$  /$$//$$__  $$ /$$__  $$| $$$$$$$      /$$$$$$/                                                                                                                                                                                                                                                                                                                                                      
 *    | $$__  $$| $$  \__/| $$  | $$| $$  | $$| $$ \ $$ \ $$| $$| $$  | $$                         \  $$/$$/| $$$$$$$$| $$  \__/|_____  $$    /$$____/                                                                                                                                                                                                                                                                                                                                   
 *    |__/  |__/|__/       \_______/ \______/ |__/ |__/ |__/|__/ \_______/                            \_/    \_______/|__/       \______/|__/|________/                                                                                                                                                                                                                                                                                                                                                      
 *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 *                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 *             /$$$           /$$$                            /$$                         /$$       /$$                                                               /$$            /$$$$$$   /$$$$$$    /$$    /$$$$$$                                                                                                                                                                                                                                                                                     
 *            /$$_/          |_  $$                          | $$                        |__/      | $$                                                              | $$           /$$__  $$ /$$$_  $$ /$$$$   /$$__  $$                                                                                                                                                                                                                                                                                    
 *           /$$/    /$$$$$$$  \  $$ /$$$$$$   /$$$$$$   /$$$$$$$ /$$   /$$ /$$$$$$/$$$$  /$$  /$$$$$$$        /$$$$$$   /$$$$$$   /$$$$$$  /$$  /$$$$$$   /$$$$$$$ /$$$$$$        |__/  \ $$| $$$$\ $$|_  $$  | $$  \ $$                                                                                                                                                                                                                                                                                    
 *          | $$    /$$_____/   | $$|____  $$ /$$__  $$ /$$__  $$| $$  | $$| $$_  $$_  $$| $$ /$$__  $$       /$$__  $$ /$$__  $$ /$$__  $$|__/ /$$__  $$ /$$_____/|_  $$_/          /$$$$$$/| $$ $$ $$  | $$  |  $$$$$$/                                                                                                                                                                                                                                                                                    
 *          | $$   | $$         | $$ /$$$$$$$| $$  \__/| $$  | $$| $$  | $$| $$ \ $$ \ $$| $$| $$  | $$      | $$  \ $$| $$  \__/| $$  \ $$ /$$| $$$$$$$$| $$        | $$           /$$____/ | $$\ $$$$  | $$   >$$__  $$                                                                                                                                                                                                                                                                                    
 *          |  $$  | $$         /$$//$$__  $$| $$      | $$  | $$| $$  | $$| $$ | $$ | $$| $$| $$  | $$      | $$  | $$| $$      | $$  | $$| $$| $$_____/| $$        | $$ /$$      | $$      | $$ \ $$$  | $$  | $$  \ $$                                                                                                                                                                                                                                                                                    
 *           \  $$$|  $$$$$$$ /$$$/|  $$$$$$$| $$      |  $$$$$$$|  $$$$$$/| $$ | $$ | $$| $$|  $$$$$$$      | $$$$$$$/| $$      |  $$$$$$/| $$|  $$$$$$$|  $$$$$$$  |  $$$$/      | $$$$$$$$|  $$$$$$/ /$$$$$$|  $$$$$$/                                                                                                                                                                                                                                                                                    
 *            \___/ \_______/|___/  \_______/|__/       \_______/ \______/ |__/ |__/ |__/|__/ \_______/      | $$____/ |__/       \______/ | $$ \_______/ \_______/   \___/        |________/ \______/ |______/ \______/                                                                                                                                                                                                                                                                                     
 *                                                                                                           | $$                     /$$  | $$                                                                                                                                                                                                                                                                                                                                                              
 *                                                                                                           | $$                    |  $$$$$$/                                                                                                                                                                                                                                                                                                                                                              
 *                                                                                                           |__/                     \______/                                                                                                                                                                                                                                                                                                                                                               
 *                                                     /$$                       /$$$$$$$$        /$$                           /$$       /$$                                                                                                                                                                                                                                                                                                                                                                
 *                                                    | $$                      | $$_____/       | $$                          | $$      |__/                                                                                                                                                                                                                                                                                                                                                                
 *                                                    | $$$$$$$  /$$   /$$      | $$    /$$   /$$| $$   /$$ /$$   /$$  /$$$$$$$| $$$$$$$  /$$ /$$$$$$/$$$$   /$$$$$$                                                                                                                                                                                                                                                                                                                                         
 *                                                    | $$__  $$| $$  | $$      | $$$$$| $$  | $$| $$  /$$/| $$  | $$ /$$_____/| $$__  $$| $$| $$_  $$_  $$ |____  $$                                                                                                                                                                                                                                                                                                                                        
 *                                                    | $$  \ $$| $$  | $$      | $$__/| $$  | $$| $$$$$$/ | $$  | $$|  $$$$$$ | $$  \ $$| $$| $$ \ $$ \ $$  /$$$$$$$                                                                                                                                                                                                                                                                                                                                        
 *                                                    | $$  | $$| $$  | $$      | $$   | $$  | $$| $$_  $$ | $$  | $$ \____  $$| $$  | $$| $$| $$ | $$ | $$ /$$__  $$                                                                                                                                                                                                                                                                                                                                        
 *                                                    | $$$$$$$/|  $$$$$$$      | $$   |  $$$$$$/| $$ \  $$|  $$$$$$/ /$$$$$$$/| $$  | $$| $$| $$ | $$ | $$|  $$$$$$$                                                                                                                                                                                                                                                                                                                                        
 *                                                    |_______/  \____  $$      |__/    \______/ |__/  \__/ \______/ |_______/ |__/  |__/|__/|__/ |__/ |__/ \_______/                                                                                                                                                                                                                                                                                                                                        
 *                                                               /$$  | $$                                                                                                                                                                                                                                                                                                                                                                                                                                   
 *                                                              |  $$$$$$/                                                                                                                                                                                                                                                                                                                                                                                                                                   
 *                                                               \______/                                                                                                                                                                                                                                                                                                                                                                                                                                    
 */

void software_reset() {
  asm volatile ("  jmp 0"); 
}



//-----------------------------------------------------------------
//------------------------INCLUDE------------------------------------
//-----------------------------------------------------------------

#include <EEPROM.h>
#include <LiquidCrystal.h>
#include <KanaLiquidCrystal.h>
#include <Tone.h>
#include <MIDI.h>
#include "freq.h"
#include <SoftwareSerial.h>
SoftwareSerial NANO(13, 19);
KanaLiquidCrystal lcd( 8, 6, 15, 16, 17, 18, 10, 11, 12, 7 );
//-----------------------------------------------------------------
//------------------------MODESET----------------------------------
//-----------------------------------------------------------------
String const doTOsi[] = {"ﾄﾞ", "ﾄﾞ#", "ﾚ", "ﾚ#", "ﾐ", "ﾌｧ", "ﾌｧ#", "ｿ", "ｿ#", "ﾗ", "ｼb", "ｼ"};
String const cTOb[] = {"C ", "C#", "D ", "D#", "E ", "F ", "F#", "G ", "G#", "A ", "A#", "B "};
//-----------------------------------------------------------------
//------------------------MODE_DOREMI------------------------------
//-----------------------------------------------------------------
String numTOdrm(int n) {
  int i = n % 12;
  return doTOsi[i];
}
//-----------------------------------------------------------------
//------------------------MODE_CDE---------------------------------
//-----------------------------------------------------------------
String numTOcde(int n) {
  int i = n % 12;
  int ii = n / 12-1;
  if(cTOb[i].length()<2){
    return cTOb[i]+" "+ii;
  }else{
  return cTOb[i]+ii;
}}
//-----------------------------------------------------------------
//------------------------VARIABLE---------------------------------
//-----------------------------------------------------------------

byte M_oto [8]={
B00110,
B00101,
B00100,
B00100,
B00100,
B11100,
B11100,
B11100,


  
};
byte M_bata[8]={
  B01100,
  B10010,
  B11100,
  B10010,
  B11100,
  B10000,
  B10000,
  B10000,
};
byte M_alpha[8]={
  B00000,
 

  B01001,
  B10101,
  B10010,
  B10010,
  B10010,
  B10010,
  B01101,

  
};
byte M_yama[8]={
  B01110,
  B01110,
  B01110,
  B01110,
  B01110,
  B01110,
  B11111,
  B00000,
};
byte M_11[8]={
  B01001,
  B11011,
  B01001,
  B01001,
  B01001,
  B01001,
  B01001,
  B01001,
};
byte M_12[8]={
  B10111,
  B10001,
  B10001,
  B10111,
  B10100,
  B10100,
  B10100,
  B10111,
  
};
byte M_10[8]={
B10111,
B10101,
B10101,
B10101,
B10101,
B10101,
B10101,
B10111,

  
};

 int MIDI_CH = 1;

const int CH_CNT = 6;
int intervals[CH_CNT] = {0, 0, 0, 0, 0, 0};
Tone tones[3];
const byte SND_PINS[3] = {2, 3, 4};
int nowData[CH_CNT] = {0, 0, 0, 0, 0, 0};

String now2[CH_CNT] = {"___", "___", "___", "___", "___", "___"};
bool old = LOW;
bool sold = LOW;
bool MENUo = LOW;
bool cfm=false;
int SETm=0;
bool doremi = false;
int basenote=0;
byte page=0;
bool inputBlock=false;
bool hyouzi=false;
MIDI_CREATE_DEFAULT_INSTANCE();

//-----------------------------------------------------------------
//------------------------DIGIT------------------------------------
//-----------------------------------------------------------------

unsigned dgt(unsigned num) {
  unsigned digit = 0;
  if (num != 0) {
    while (num != 0) {
      num /= 10;
      digit++;
    }
  } else {
    digit = 1;
  }
  return digit;
}

void mtr(){
  int b=basenote;
  if(b<-7){

    lcd.write(5);
    lcd.print("____");
    
    }else if(b<-2){
      
       lcd.print("_");
    lcd.write(5);
    lcd.print("___");
    
    }else if(b<3){
      
      lcd.print("__");
       lcd.write(5);
    lcd.print("__");
    
    }else if(b<8){
       
    lcd.print("___");
       lcd.write(5);
    lcd.print("_");
    
    }else if(b<13){ 
       
      lcd.print("____");
       lcd.write(5);

    }
    
  
}
void save(int ad,byte dat){
  EEPROM.write(ad,dat);
}
void saveALLdata(){
  cfm=false;
lcd.clear();
lcd.print("ｾｰﾌﾞﾁｭｳ");
lcd.setCursor(10,1);

save(1,basenote+128);
save(2,MIDI_CH);
if(doremi){
save(3,1);
}else{
  save(3,0);
}
inputBlock?save(4,1):save(4,0);

lcd.clear();
lcd.print("ｾｰﾌﾞｶﾝﾘｮｳ");
  
}
void roadALLdata(){
if(EEPROM.read(1)!=255){
  basenote=EEPROM.read(1)-128;
}else{basenote=0;
}
if(EEPROM.read(2)!=255){
 MIDI_CH=EEPROM.read(2);
}
if(EEPROM.read(3)!=255){
byte iii=EEPROM.read(3);
if(iii==0){doremi=false;
}else{
  doremi=true;
}
}
if(EEPROM.read(4)!=255){
  byte iii=EEPROM.read(4);
if(iii==0){inputBlock=false;
}else{
  inputBlock=true;
}
}
}
//-----------------------------------------------------------------
//-----------------------LCD_PUT-----------------------------------
//-----------------------------------------------------------------
void pppppp(String vlooooooo) {
  for(int CN = 0; CN < vlooooooo.length(); CN++){
    lcd.print(vlooooooo[CN]);
    delay(25);
  }
}
//-----------------------------------------------------------------
//------------------------SETUP------------------------------------
//-----------------------------------------------------------------

void setup(){
  roadALLdata();
  //----------------------------------------------------------------
  //------------------------PIN--------------------------------------
  //-----------------------------------------------------------------
  pinMode(9, INPUT);
  pinMode(5, INPUT);
  pinMode(14, INPUT);


  //-----------------------------------------------------------------
  //------------------------LCD--------------------------------------
  //-----------------------------------------------------------------
  lcd.createChar(3,M_bata);  
  lcd.createChar(4,M_alpha);
  lcd.createChar(2,M_oto);
   lcd.createChar(5,M_yama);
   lcd.createChar(6,M_11);
   lcd.createChar(7,M_12);
   lcd.createChar(1,M_10);
  lcd.begin( 16, 2 );
  
  lcd.clear();
  delay(100);

 
roadALLdata();
delay(100);
lcd.print(F("roading ok;)"));
lcd.setCursor(0,1);
lcd.print(MIDI_CH);
lcd.setCursor(4,1);
lcd.print(basenote);
lcd.setCursor(8,1);
lcd.print(doremi);
lcd.setCursor(11,1);
lcd.print(inputBlock);
delay(500);
  lcd.clear();
 lcd.kanaOn();
 lcd.home();
 delay(100);
  pppppp( F( "ArduMid "));
  lcd.write(2);
  pppppp(F(" Rev.6"));
  lcd.setCursor(3,1);
  delay(10);
 
  pppppp(F("ﾊﾞｰｼﾞｮﾝ 2.0"));
  bool alph=false;
  alph? lcd.write(4):lcd.write(3);
 
  delay(250);
  
  //-----------------------------------------------------------------
  //------------------------SERIAL------------------------------------
  //------------------------------------------------------------------
  for (int i = 0; i < 3; i++) {
    pinMode(SND_PINS[i], OUTPUT);
    tones[i].begin(SND_PINS[i]);
  }
  NANO.begin(31250);
  MIDI.begin();
  if(MIDI_CH<17&&MIDI_CH!=255){
    MIDI.setInputChannel(MIDI_CH);
  
  
}else{
  MIDI.setInputChannel(MIDI_CHANNEL_OMNI);
}

}

//-----------------------------------------------------------------
//------------------------LOOP-------------------------------------
//-----------------------------------------------------------------
void loop()
{

  uint8_t data1, data2;


  if (MIDI.read()) {


    switch (MIDI.getType()) {



      //-------------------------------------------------------------------
      //----------------------NOTEON---------------------------------------
      //-------------------------------------------------------------------
      case midi::NoteOn:
if(!inputBlock){
        data1 = MIDI.getData1()+basenote;
        if(data1<5)break;
        data2 = MIDI.getData2();

        if (data2 > 0) {
          for (byte i = 0; i < CH_CNT; i++) {
            if (intervals[i] == 0) {
              intervals[i] = data1;
              
              if (i < 3) {
                tones[i].play(noteFreq[data1]);
              } else {
                //-------------------------MIDI_PUT-------------------------------
                NANO.write(0x90);
                NANO.write(data1);
                NANO.write(127);

              }
              nowData[i] = noteFreq[data1];

              if (doremi) {
                now2[i] = numTOdrm(data1);
              } else {
                now2[i] = numTOcde(data1);
              }
              //-----------------------------------------------------------------
              //------------------------LCD_NOTEON-------------------------------
              //-----------------------------------------------------------------
              if(hyouzi==true){
              lcd.clear();

              lcd.setCursor(1, 0);
              lcd.print(now2[0]);


              lcd.setCursor(5, 0);
              lcd.print(now2[1]);

              lcd.setCursor(9, 0);
              lcd.print(now2[2]);

              lcd.setCursor(13, 0);
              lcd.print(now2[3]);

              lcd.setCursor(1, 1);
              lcd.print(now2[4]);

              lcd.setCursor(5, 1);
              lcd.print(now2[5]);
              if(basenote<10&&basenote>-10){
                lcd.setCursor(9,1);
                if(basenote>0){
              lcd.print("+");
                }
              lcd.print(basenote);
              }else{
                lcd.setCursor(9,1);
switch(basenote){
case 10:
lcd.print("+");
lcd.write(1);
  break;
  case 11:
lcd.print("+");
lcd.write(6);
  break;
  case 12:
lcd.print("+");
lcd.write(7);
  break;
  case -10:
lcd.print("-");
lcd.write(1);
  break;
    case -11:
lcd.print("-");
lcd.write(6);
  break;
    case -12:
lcd.print("-");
lcd.write(7);
  break;
}

   
              }
              
              



              if (MIDI_CH == 17) {
                lcd.setCursor(11, 1);
                lcd.print("All");

              } else {
                lcd.setCursor(14 - dgt(MIDI_CH), 1);
                lcd.print(MIDI_CH);


              }
              lcd.setCursor(14, 1);
              lcd.print("CH");

              break;


            }
          }}
        }
          break;
}

        //------------------------------------------------------------------
        //----------------------------NOTEOFF-------------------------------
        //------------------------------------------------------------------
        case midi::NoteOff:

if(!inputBlock){
          data1 = MIDI.getData1()+basenote;


          for (int i = 0; i < CH_CNT; i++) {
            if (intervals[i] == data1) {
              intervals[i] = 0;
              if (i < 3) {
                tones[i].stop();
                //------------------------MIDI_PUT_OFF----------------------------
              } else {
                NANO.write(0x80);
                NANO.write(data1);
                NANO.write(127);

              }
              nowData[i] = 0;
              //-----------------------------------------------------------------
              //------------------------LCD_NOTEOFF------------------------------
              //-----------------------------------------------------------------
              now2[i] = "___";
if(hyouzi==true){
              lcd.clear();

              lcd.setCursor(1, 0);
              lcd.print(now2[0]);


              lcd.setCursor(5, 0);
              lcd.print(now2[1]);

              lcd.setCursor(9, 0);
              lcd.print(now2[2]);

              lcd.setCursor(13, 0);
              lcd.print(now2[3]);

              lcd.setCursor(1, 1);
              lcd.print(now2[4]);

              lcd.setCursor(5, 1);
              lcd.print(now2[5]);
       if(basenote<10&&basenote>-10){
                lcd.setCursor(9,1);
                if(basenote>0){
              lcd.print("+");
                }
              lcd.print(basenote);
              }else{
                lcd.setCursor(9,1);
switch(basenote){
case 10:
lcd.print("+");
lcd.write(1);
  break;
  case 11:
lcd.print("+");
lcd.write(6);
  break;
  case 12:
lcd.print("+");
lcd.write(7);
  break;
  case -10:
lcd.print("-");
lcd.write(1);
  break;
    case -11:
lcd.print("-");
lcd.write(6);
  break;
    case -12:
lcd.print("-");
lcd.write(7);
  break;
}
              }


              if (MIDI_CH == 17) {
                lcd.setCursor(11, 1);
                lcd.print("All");

              } else {
                lcd.setCursor(14 - dgt(MIDI_CH), 1);
                lcd.print(MIDI_CH);



              }
              lcd.setCursor(14, 1);
              lcd.print("CH");


              break;
            }}
          }




       
 
    }
  }
  }

  
  //-------------------------------------------------------------
  //------------------SETTING------------------------------------
  //-------------------------------------------------------------


  


if(digitalRead(14)==HIGH&&MENUo==LOW){
  hyouzi=false;
    for (int i = 0; i < CH_CNT; i++) {
     
  
      if(i<3){
          tones[i].stop();
      }else if(i==5){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
  MENUo=HIGH;
page=0;

  if(SETm==0){
SETm++;
   
    lcd.clear();
  lcd.print("  ﾐｭｰﾄ");
  lcd.setCursor(7,1);
  
  inputBlock?lcd.print("ON"):lcd.print("OFF");


  
  }else if(SETm==1){
  SETm++;
    
    //-----------------------------------------------------------------
    //------------------------LCD_MODE---------------------------------
    //-----------------------------------------------------------------
    lcd.clear();
    lcd.print(F(" ｵﾝｶｲ ﾓｰﾄﾞ="));
    lcd.setCursor(5, 1);
    lcd.print(doremi == false ? "C C# D" : "ﾄﾞ ﾄﾞ# ﾚ");
    
}else if(SETm==2){
SETm++;
    lcd.clear();
    lcd.home();
    lcd.print("ﾆｭｳﾘｮｸ ");
    lcd.setCursor(0, 1);
    lcd.print("  ﾁｬﾝﾈﾙ=");
    if (MIDI_CH == 17) {
      lcd.print(F("ALLﾁｬﾝﾈﾙ"));
    } else {
      (MIDI_CH < 10) ? lcd.setCursor(10, 1) : lcd.setCursor(9, 1);
      lcd.print(MIDI_CH);
      lcd.setCursor(11, 1);
      lcd.print("ﾁｬﾝﾈﾙ");
    }
}else if(SETm==3){
SETm++;
lcd.clear();
lcd.print(F(" ｵﾝｶｲﾁｮｳｾｲ "));
mtr();
lcd.setCursor(0,1);
lcd.print(" ｷｰ  b/# ");
  if(basenote<10&&basenote>-10){
                lcd.setCursor(9,1);
                if(basenote>0){
              lcd.print("+");
                }
              lcd.print(basenote);
              }else{
                lcd.setCursor(9,1);
switch(basenote){
case 10:
lcd.print("+");
lcd.write(1);
  break;
  case 11:
lcd.print("+");
lcd.write(6);
  break;
  case 12:
lcd.print("+");
lcd.write(7);
  break;
  case -10:
lcd.print("-");
lcd.write(1);
  break;
    case -11:
lcd.print("-");
lcd.write(6);
  break;
    case -12:
lcd.print("-");
lcd.write(7);
  break;
}}
}else if(SETm==4){
  SETm++;
  lcd.clear();
  lcd.print(F("EEPROMﾆ､ｾｯﾃｲｦ"));
  lcd.setCursor(0,1);
  lcd.print(F(" ﾎｿﾞﾝ､ｼﾏｽｶ? "));
}else if(SETm==5){
  SETm++;
  lcd.clear();
  lcd.print(F("ｻｲｷﾄﾞｳｼﾏｽｶ?")                                                                                                                                                                                                                                                   );
  

  
}else if(SETm==6){
  page=0;
  lcd.clear();
  lcd.print("Copyright 2017");
  lcd.setCursor(0,1);
  lcd.print("Ardumid Project");
SETm++;

 //SETm=0; 
}else if(SETm==7){
page=0;
lcd.clear();
lcd.print("ｵﾝｶｲﾋｮｳｼﾞ");
hyouzi=true;
SETm=0;  
}
}else if(digitalRead(14)==LOW){
  MENUo=LOW;
}






//-------------------------------------------------------
//---------------------RIGHT-----------------------------
//-----------------------------------------------------
if(digitalRead(9)&&old==LOW){
old=HIGH;
if(SETm==0){ 
  if(page<2)page++;
 if(page==0){ 
 
   lcd.clear();
  lcd.print("Copyright 2017");
  lcd.setCursor(0,1);
  lcd.print("Ardumid Project");
 }
 else if(page==1){


lcd.clear();
lcd.print(F("project by ikura"));
lcd.setCursor(0,1);
lcd.print("vision 2.1 ");
 }
else if(page==2){
  
  lcd.clear();
  lcd.print("latest update");
  lcd.setCursor(0,1);
  lcd.print("  2017/10/26");
 }
}
if(SETm==1){
   for (int i = 0; i < CH_CNT; i++) {
    if(i<3){
          tones[i].stop();
      }else if(i==5){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
  lcd.clear();
  lcd.print("  ﾐｭｰﾄ");
  lcd.setCursor(7,1);
  inputBlock=!inputBlock;
  inputBlock?lcd.print("ON"):lcd.print("OFF");
 
  

}
if(SETm==2){
  doremi=!doremi;
      lcd.clear();
    lcd.print(" ｵﾝｶｲ ﾓｰﾄﾞ=");
    lcd.setCursor(5, 1);
    lcd.print(doremi == false ? "C C# D" : "ﾄﾞ ﾄﾞ# ﾚ");
}
if(SETm==3){


    (MIDI_CH < 17) ? MIDI_CH++ : MIDI_CH = 1;
    if ( MIDI_CH == 17) {
      MIDI.begin(MIDI_CHANNEL_OMNI);
    } else {
      MIDI.setInputChannel(MIDI_CH);
    }

    for (int i = 0; i < CH_CNT; i++) {
     
  
      if(i<3){
          tones[i].stop();
      }else if(i==5){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
        lcd.clear();
    lcd.home();
    lcd.print("ﾆｭｳﾘｮｸ ");
    lcd.setCursor(0, 1);
    lcd.print(F("  ﾁｬﾝﾈﾙ="));
    if (MIDI_CH == 17) {
      lcd.print(F("ALLﾁｬﾝﾈﾙ"));
    } else {
      (MIDI_CH < 10) ? lcd.setCursor(10, 1) : lcd.setCursor(9, 1);
      lcd.print(MIDI_CH);
      lcd.setCursor(11, 1);
      lcd.print("ﾁｬﾝﾈﾙ");
    }
}else if(SETm==4){
  if(basenote<12){
      for (int i = 0; i < CH_CNT; i++) {
     
  
      if(i<3){
          tones[i].stop();
      }else if(i==4){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
basenote++;
}
lcd.clear();
lcd.print(F(" ｵﾝｶｲﾁｮｳｾｲ "));
mtr();
lcd.setCursor(0,1);
lcd.print(" ｷｰ  b/# ");
  if(basenote<10&&basenote>-10){
                lcd.setCursor(9,1);
                if(basenote>0){
              lcd.print("+");
                }
              lcd.print(basenote);
              }else{
                lcd.setCursor(9,1);
switch(basenote){
case 10:
lcd.print("+");
lcd.write(1);
  break;
  case 11:
lcd.print("+");
lcd.write(6);
  break;
  case 12:
lcd.print("+");
lcd.write(7);
  break;
  case -10:
lcd.print("-");
lcd.write(1);
  break;
    case -11:
lcd.print("-");
lcd.write(6);
  break;
    case -12:
lcd.print("-");
lcd.write(7);
  break;
}
              }
}else if(SETm==5){
  if(cfm==false){
lcd.clear();
lcd.print(F("ﾎﾝﾄｳﾆﾎｿﾞﾝｼﾏｽｶ?"));
cfm=!cfm;
  }else{
    saveALLdata();
  }

 
}else if(SETm==6){
  lcd.clear();
  lcd.print("ｻｲｷﾄﾞｳｼﾏｽ!");
  software_reset();
}
}else if(digitalRead(9)==LOW){
  old=LOW;
}
//--------------------------------------------------
//------------LEFT-----------------------------------
//------------------------------------------------
if(digitalRead(5)==HIGH&&sold==LOW){
  sold=HIGH;
  if(SETm==0){
    if(page>0)page--;
if(page==0){
   lcd.clear();
  lcd.print(F("Copyright 2017"));
  lcd.setCursor(0,1);
  lcd.print("Ardumid Project");
}
    else if(page==1){ 

lcd.clear();
lcd.print("project by ikura");
lcd.setCursor(0,1);
lcd.print(F("vision 2.1"));
 }
 else if(page==2){

  lcd.clear();
  lcd.print(F("latest update"));
  lcd.setCursor(0,1);
  lcd.print("  2017/10/26");
 }
  }else if(SETm==1){
    
  
  } else if(SETm==2){
  doremi=!doremi;
      lcd.clear();
    lcd.print(F(" ｵﾝｶｲ ﾓｰﾄﾞ="));
    lcd.setCursor(5, 1);
    lcd.print(doremi == false ? "C C# D" : "ﾄﾞ ﾄﾞ# ﾚ");
}
  if(SETm==3){
    (MIDI_CH == 1) ? MIDI_CH = 17:MIDI_CH--;
    if ( MIDI_CH == 17) {
      MIDI.begin(MIDI_CHANNEL_OMNI);
    } else {
      MIDI.setInputChannel(MIDI_CH);
    }

    for (int i = 0; i < CH_CNT; i++) {
     
  
      if(i<3){
          tones[i].stop();
      }else if(i==5){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
        lcd.clear();
    lcd.home();
    lcd.print("ﾆｭｳﾘｮｸ ");
    lcd.setCursor(0, 1);
    lcd.print(F("  ﾁｬﾝﾈﾙ="));
    if (MIDI_CH == 17) {
      lcd.print(F("ALLﾁｬﾝﾈﾙ"));
    } else {
      (MIDI_CH < 10) ? lcd.setCursor(10, 1) : lcd.setCursor(9, 1);
      lcd.print(MIDI_CH);
      lcd.setCursor(11, 1);
      lcd.print("ﾁｬﾝﾈﾙ");
    }


  }else if(SETm==4){
  if(basenote>-12){
      for (int i = 0; i < CH_CNT; i++) {
     
  
      if(i<3){
          tones[i].stop();
      }else if(i==5){
        NANO.write(0x90);
        NANO.write(100);
        NANO.write(0x40);
      }
        intervals[i] = 0;
    nowData[i] = 0;
    now2[i]="___";
    }
basenote--;
}
lcd.clear();
lcd.print(F(" ｵﾝｶｲﾁｮｳｾｲ "));
mtr();
lcd.setCursor(0,1);
lcd.print(F(" ｷｰ  b/# "));
  if(basenote<10&&basenote>-10){
                lcd.setCursor(9,1);
                if(basenote>0){
              lcd.print("+");
                }
              lcd.print(basenote);
              }else{
                lcd.setCursor(9,1);
switch(basenote){
case 10:
lcd.print("+");
lcd.write(1);
  break;
  case 11:
lcd.print("+");
lcd.write(6);
  break;
  case 12:
lcd.print("+");
lcd.write(7);
  break;
  case -10:
lcd.print("-");
lcd.write(1);
  break;
    case -11:
lcd.print("-");
lcd.write(6);
  break;
    case -12:
lcd.print("-");
lcd.write(7);
  break;
}
}
  }
} else if (digitalRead(5) == LOW) {
    sold = LOW;
  }

}





